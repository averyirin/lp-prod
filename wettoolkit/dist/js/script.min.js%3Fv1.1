$(function(){function a(a,b){a.trigger("click")}function b(){new Array;$.ajax({url:elgg.get_site_url()+"users/get",success:function(a){h=JSON.parse(a)}})}function c(a){return a.split(/@\s*/)}function d(a){return c(a).pop()}$("a.menu").click(function(a){a.preventDefault();var b=$("ul.elgg-menu-site-default");$("ul.elgg-menu-site-default").slideToggle("slow"),$(window).resize(function(){var a=$(window).width();a>768&&b.is(":hidden")&&b.removeAttr("style")})}),window.innerWidth<990,$(window).resize(function(){var b=$("#ajax-form .mceEditor"),c=$("#ajax-form").find(".tinymce-toggle-editor");window.innerWidth<990&&b.length>=1?a(c,"hide"):window.innerWidth>=991&&0==b.length&&c.length>=1&&a(c,"show")});var e=function(){this.setProperties(),$(this.init)};e.prototype.setProperties=function(){this.ajaxForm=$("#ajax-form"),this.ajaxLoader=elgg.normalize_url("/_graphics/ajax_loader.gif"),this.placeholder=!0,this.filterLink=$("#widget-welcome > ul li"),this.selectedClass=".selected",this.activeClass=".active",this.contentDiv=$(".widget-welcome-content"),this.searchBar=$(".index-search input[type=text]"),this.shareLinks=$(".widget-welcome-content #share-content > a"),this.createLinks=$(".widget-welcome-content #create-content > a"),this.firstClick=!1,that=this},e.prototype.init=function(){that.filterLink.click(that.loadButtons),that.searchBar.focus(that.clearSearch),that.shareLinks.bind("click",{key:"share"},that.loadForm),that.createLinks.bind("click",{key:"create"},that.loadForm)},e.prototype.loadButtons=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1,that.ajaxForm.empty(),that.ajaxForm.append("<form></form>"),$(this).parents("ul").find(that.selectedClass).removeClass(that.selectedClass.substring(1)),$(this).addClass(that.selectedClass.substring(1)),contentLink=$(this).find("a");var b=$(contentLink).attr("href");that.contentDiv.find(that.activeClass).fadeOut(400,"easeOutQuad",function(){$(this).removeClass(that.activeClass.substring(1)),$(this).parent().find("#"+b+"-content").addClass(that.activeClass.substring(1)).hide().fadeIn(400,"easeInQuad")})},e.prototype.clearSearch=function(){that.placeholder&&($(this).val(""),that.placeholder=!1)},e.prototype.loadForm=function(a){event=a,event.preventDefault?event.preventDefault():event.returnValue=!1,that.ajaxForm.empty(),that.ajaxForm.append("<div class='ajax-spinner'><img src='"+that.ajaxLoader+"' alt='Loading Content'/></div>");var b=$(this).attr("href");request="share"==a.data.key?"share_content":"create_content",elgg.get(request+"/"+b.substring(1),{success:function(a,b,c){that.ajaxForm.hide(),that.ajaxForm.children().first().replaceWith(a),that.ajaxForm.fadeIn(600);var d=$(that.ajaxForm).find(".tinymce-toggle-editor");d.length>=1&&d.trigger("click")}})};var f=["all","learner","developer","instructor","trainingmgr"];$("#filter-resources").live("change",function(){var a=this.value;$("div").removeClass("selected");var b=$("div."+f[a]);$(b).addClass("selected")});var g=function(){this.setProperties(),$(this.init)};g.prototype.setProperties=function(){this.activeClass="active",this.activityFeed="div#activity-feed > ul",this.activityFilter=$("ul#activity-filter li"),this.ajaxLoader=elgg.normalize_url("/_graphics/ajax_loader.gif"),activity_widget=this},g.prototype.init=function(){activity_widget.activityFilter.click(activity_widget.filter)},g.prototype.filter=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1,$(this).parent().children().removeClass(activity_widget.activeClass),$(this).addClass(activity_widget.activeClass);var b=$(this),c=b.parent().parent(),d=b.find("a").attr("href"),e=c.find("div#activity-feed > ul"),f=$("div#activity-feed > ul");activity_widget.getRiver(d,e,f)},g.prototype.getRiver=function(a,b,c){b.fadeOut(400,function(){$(this).empty("li"),$(this).append("<div class='ajax-spinner'><img src='"+activity_widget.ajaxLoader+"' alt='Loading Content...' /></div>").fadeIn(100)}),elgg.get("river_activity/"+a.substring(1),{success:function(a,d,e){b.fadeOut(400,function(){a?($(this).replaceWith(a),c.fadeIn(400)):$(this).replaceWith("<ul></ul>")})}})},elgg.get("feature/hasSeen/landingFeature",{success:function(a,b,c){a||($("#joyRideTipContent").joyride({autoStart:!0,modal:!0,expose:!0,prevButton:!0}),elgg.post("feature/seen/landingFeature",{success:function(a,b,c){},error:function(){}}))}}),$("#add-bookmark").click(function(a){a.preventDefault();var b=elgg.get_site_url()+"bookmarks/add/"+elgg.get_logged_in_user_guid()+"?address="+document.URL;$.fancybox({href:b,width:600,height:500,padding:16,titleShow:!1,autoDimensions:!1})}),$("form#ajax-form").live("submit",function(a){$("p.error").remove();var b=$(this).find("input[name=__elgg_token]").val(),c=$(this).find("input[name=__elgg_ts]").val(),d=$(this).find("input[name=title]").val(),e=$(this).find("textarea[name=description]").val(),f=$(this).find("input[name=address]").val(),g=$(this).find("select[name=access_id]").val(),h=$(this).find("input[name=tags]").val(),i=$(this).find("input[name=guid]").val()?$(this).find("input[name=guid]").val():null,j=$(this).find("input[name=container_guid]").val();if(d&&f){var k=elgg.post("action/bookmarks/save",{data:{__elgg_token:b,__elgg_ts:c,title:d,description:e,address:f,access_id:g,tags:h,guid:i,container_guid:j}});k.done(function(a){obj=JSON.parse(a),success=obj.system_messages.success,error=obj.system_messages.error,$.fancybox.close(),success?elgg.system_message(success):error&&elgg.system_message(error)})}else if(d){if(!f){var l=$(this).find("input[name=address]").position();$(this).find("input[name=address]").prevAll("label").append("<p class='error' style='display:inline-block;color:red;margin-left:5px;'>*Please provide an address</p>"),$("#fancybox-content > div").scrollTop(l.top)}}else{var l=$(this).find("input[name=title]").position();$(this).find("input[name=title]").prevAll("label").append("<p class='error' style='display:inline-block;color:red;margin-left:5px;'>*Please provide a title</p>"),$("#fancybox-content > div").scrollTop(l.top)}return!1}),$("#start-tour").click(function(a){a.preventDefault(),joyRideContent=$("#joyRideTipContent"),jQuery.contains(document,joyRideContent[0])?$("#joyRideTipContent").joyride({autoStart:!0,modal:!0,expose:!0,prevButton:!0}):alert("No Training Aid For This Page")}),$("#filter-dropdown > a").click(function(a){a.preventDefault?a.preventDefault():a.returnValue=!1,that=$(this),filterDropdown=$(this).parent().find("ul"),$(filterDropdown).css("width",that.innerWidth()-1),$(filterDropdown).slideToggle()});var h;b();var i=[];$(".elgg-page-body").delegate("input[name='generic_comment'], textarea[name='generic_comment'], textarea[id='thewire-textarea'], input[name='questiontitle'], form#form-edit-object-hjforumpost textarea[name='description']","keydown",function(a){a.keyCode===$.ui.keyCode.TAB&&$(this).data("autocomplete").menu.active&&a.preventDefault();for(var b in i)$(this).val().indexOf(i[b].username)>=0&&(i[b].termIndex=$(this).val().indexOf("@"+i[b].username));textarea=this,$(this).autocomplete({minLength:0,source:function(a,b){if(i)for(var c in i)if(-1==$(textarea).val().indexOf(i[c].username)){pos=parseInt(c)+1;var e=$(textarea).val();firstHalf=e.substring(0,i[c].termIndex),secondHalf=e.substring(i[c].termIndex+i[c].username.length),$(textarea).val(firstHalf+secondHalf),$("input[name='user-callout-id[]'][value="+i[c].id+"]").remove(),i.splice(c,1)}var f=a.term,g=[];if(f.indexOf("@")>=0){if(f=d(a.term),f.length>0)for(var j in h)0==h[j].name.toLowerCase().indexOf(f.toLowerCase())&&g.push(h[j]);else g=["Start typing..."];b($.map(g,function(a){return a.id?{label:a.name,value:a.name,id:a.id,username:a.username}:g}))}$(textarea).val().indexOf("@")<=-1&&b(g)},focus:function(){return!1},select:function(a,b){var c=this.value.split("@");c.pop();for(var d in c)for(var e in i)c[d].indexOf(i[e].username)>=0&&(c[d]="@"+c[d]);return c.push("@"+b.item.username),c.push(""),this.value=c.join(""),$("<input type='hidden' name='user-callout-id[]' value='"+b.item.id+"'/> ").insertBefore($(textarea)),i.unshift(b.item),!1}})});var j=(new e,new g);j.getRiver("#all",$("div#activity-feed > ul"),$("div#activity-feed > ul"))});